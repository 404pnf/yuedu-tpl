// Generated by CoffeeScript 1.8.0
var root;

root = typeof global !== "undefined" && global !== null ? global : window;

if (root.YD == null) {
  root.YD = {};
}

YD.ydMakeChart = function() {
  var drawChart, onFailure;
  drawChart = function(data) {
    return AmCharts.makeChart("chartdiv", {
      type: "serial",
      theme: "light",
      dataProvider: data,
      categoryField: "date",
      startDuration: 1,
      rotate: false,
      categoryAxis: {},
      graphs: [
        {
          type: "column",
          columnWidth: 0.3,
          title: "",
          valueField: "value",
          urlField: "url",
          fillAlphas: 1,
          balloonText: "[[date]]<br> <b><span style='font-size: 24px;'>[[value]]</span></b><br> <b><span style='font-size: 24px;'>点击查看详情</span></b>"
        }, {
          type: "line",
          title: "",
          valueField: "value",
          urlField: "url",
          lineThickness: 6,
          bullet: "round",
          bulletSize: 20,
          balloonText: "[[date]]<br> <b><span style='font-size: 24px;'>[[value]]</span></b><br> <b><span style='font-size: 24px;'>点击查看详情</span></b>"
        }
      ],
      creditsPosition: "top-right"
    });
  };
  onFailure = function() {
    return alert("暂时无法从服务器获取数据。请稍后再试。");
  };
  return (function() {
    return $.get("/resultsController/loginUser").done(function(d) {
      return drawChart(d);
    }).done(function(d) {
      var highestScore, sortedScore, tryTimes;
      tryTimes = d.length;
      sortedScore = _.sortBy(d, function(e) {
        return e.value;
      });
      highestScore = _.last(sortedScore).value;
      return $("#chart_info").text("我共参加了" + tryTimes + "次测试， 目前最佳成绩是" + highestScore + "级。");
    }).fail(onFailure);
  })();
};
