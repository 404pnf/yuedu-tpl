var YD=YD||{};
(function(){var l,d,f,h,e,k;l=function(b){$("#msg").empty();_.each(b,function(a,c){$("#msg").append(["<div class=",c,">",a,"</div>"].join(""))})};d=function(b,a){b&&a()};f=function(b,a,c){a=$(a).serializeJSON();$.post(b,a).done(function(a){_.has(a,"success")&&c&&c();l(a)}).fail(function(a,c,b){console.log(a);$("#msg").text(a,c,b).slideDown("slow")})};h=function(b,a,c,m){return function(){var g=m||_.identity,d=_.snapshot(b);(new EJS({url:"tpl/"+c})).update(a,g(d))}};k=function(b){console.log("NOTE: ");console.log(b)};
e=function(b,a){$.when($.ajax("/userController/show/loginUser"),$.ajax("/userController/grades"),$.ajax("/userController/photos")).done(function(c,d,g){c=_.extend(c[0],d[0],g[0]);k(c);(new EJS({url:"tpl/"+b})).update(a,c)})};YD.userShow=function(){e("user_show.ejs","user_info")};YD.userPhotoShow=function(){e("user_photo.ejs","user_photo")};YD.userEdit=function(){e("user_edit.ejs","user_info")};YD.userPhotoEdit=function(){e("user_photo_edit.ejs","user_photo")};YD.userSave=function(){f("/userController/save",
"form#user_info",YD.userShow)};YD.userPhotoSave=function(){f("/userController/save","form#user_info",YD.userPhotoShow)};$("#user_info").delegate("#user_info_edit","click",YD.userEdit);$("#user_photo").delegate("#user_photo_edit","click",YD.userPhotoEdit);$("#user_info").delegate("#user_info_save","click",YD.userSave);$("#user_photo").delegate("#user_photo_save","click",YD.userPhotoSave);YD.startDispache=function(){var b=function(){$.get("/examController/studentLogin").done(function(a){var c=_.has(a,
"currentExam"),b=c&&"0"===a.currentExam.userExamState,g=_.has(a,"upcomingExam"),e=_.has(a,"latestExamResult"),f;f=d(!e,h(a,"stack1","start_simulating.ejs"));c=d(c,h(a,"stack2","start_current.ejs",function(a){a=_.extend(a.currentExam,{button:"\u5f00\u59cb\u8003\u8bd5"});return a=e?_.extend(a,{title:"\u518d\u6d4b\u4e00\u6b21\u770b\u770b\u81ea\u5df1\u6709\u6ca1\u6709\u8fdb\u6b65"}):b?_.extend(a,{title:"\u4f60\u8fd8\u6ca1\u6709\u6d4b\u8bd5\u3002\u6765\u6d4b\u4e00\u4e0b"}):_.extend(a,{title:"\u4f60\u6709\u6d4b\u8bd5\u5c1a\u672a\u5b8c\u6210\uff0c\u53ef\u7ee7\u7eed\u6d4b\u8bd5"})}));
g=d(g,h(a,"stack2","start_upcoming.ejs",function(a){return{upcomingExam:_.map(a.upcomingExam,function(a){a.isTodayExam?(a.endTime="",a.isTodayExam="\u4eca\u5929"):a.isTodayExam="";return a})}}));a=d(e,h(a,"stack1","start_scores.ejs"));_.map([f,c,g,a],_.identity);k("\u53c8\u770b\u5230\u6211\u5566\u3002\u8bc1\u660e\u9875\u9762\u5237\u65b0\u5566\u3002")}).fail(function(a,b,d){$("#msg").text(a,b,d).slideDown("slow")})};b();setInterval(b,12E3)};YD.userLogin=function(){var b=$("input[type!='submit'], textarea, select");
b.focus(function(){$(this).parents("li").addClass("highlight")});b.blur(function(){$(this).parents("li").removeClass("highlight")});$("#forgotpassword").click(function(){$("#password").removeClass("required");$("#login").submit();$("#password").addClass("required");return!1});$("#login").validate();$("form").submit(function(a){f("/userController/save","form#login")});jQuery.extend(jQuery.validator.messages,{required:"\u5fc5\u9009\u5b57\u6bb5",remote:"\u8bf7\u4fee\u6b63\u8be5\u5b57\u6bb5",email:"\u8bf7\u8f93\u5165\u6b63\u786e\u683c\u5f0f\u7684\u7535\u5b50\u90ae\u4ef6",
url:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u7f51\u5740",date:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u65e5\u671f",dateISO:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u65e5\u671f (ISO).",number:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u6570\u5b57",digits:"\u53ea\u80fd\u8f93\u5165\u6574\u6570",creditcard:"\u8bf7\u8f93\u5165\u5408\u6cd5\u7684\u4fe1\u7528\u5361\u53f7",equalTo:"\u8bf7\u518d\u6b21\u8f93\u5165\u76f8\u540c\u7684\u503c",accept:"\u8bf7\u8f93\u5165\u62e5\u6709\u5408\u6cd5\u540e\u7f00\u540d\u7684\u5b57\u7b26\u4e32",
maxlength:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u957f\u5ea6\u6700\u591a\u662f {0} \u7684\u5b57\u7b26\u4e32"),minlength:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u957f\u5ea6\u6700\u5c11\u662f {0} \u7684\u5b57\u7b26\u4e32"),rangelength:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u957f\u5ea6\u4ecb\u4e8e {0} \u548c {1} \u4e4b\u95f4\u7684\u5b57\u7b26\u4e32"),range:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u4ecb\u4e8e {0} \u548c {1} \u4e4b\u95f4\u7684\u503c"),
max:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6700\u5927\u4e3a {0} \u7684\u503c"),min:jQuery.validator.format("\u8bf7\u8f93\u5165\u4e00\u4e2a\u6700\u5c0f\u4e3a {0} \u7684\u503c")})}})();
